options {
	listen-on-v6 { <%= @_ipv6_listen -%>; };
	listen-on { <%= @_ipv4_listen -%>; };
	directory "<%= @wrkdir -%>";
	pid-file "<%= @pidfile -%>";
	dump-file "<%= @dumpfile -%>";
	statistics-file "<%= @statsfile -%>";
<% if @_miscopts -%>
<%   @_miscopts.each do |line| -%>
	<%= line -%>;
<%   end -%>
<% end -%>
};
<% @_views.each do |view|
   name = view.keys[0] 
   params = view[view.keys[0]] -%>
view "<%= name -%>" { match-clients { <%= params['services'].join("; ") -%>; };
<%   if params['recursion'] then -%>
	recursion yes;
<%   else -%>
	recursion no;
<%   end -%>
<%   params['zones'].each do |zone| -%>
<%     if zone.is_a?(Hash)
         zone_name = zone.keys[0]
         zone_params = zone[zone.keys[0]] -%>
<%     else
         zone_name = zone
         zone_params = @_zone_params[zone] -%>
<%     end
       if zone_params['type'] == 'include' -%>
	include "<%= @_chrootref -%>/<%= zone_name -%>";
<%     else -%>
	zone "<%= zone_name -%>" {
		type <%= zone_params['type'] -%>;
<%       if zone_params['type'] == 'master' -%>
		file "<%= @_chrootref -%>/master/<%= zone_params['source'] -%>.db";
<%       elsif zone_params['type'] == 'slave'
         if zone_params['store'] -%>
		file "<%= @_chrootref -%>/slave/<%= zone_params['store'] -%>";
<%         else -%>
		file "<%= @_chrootref -%>/slave/<%= zone_name.gsub("/","_") -%>.db_<%= name -%>";
<%         end -%>
		masters { <%= zone_params['masters'].join("; ") -%>; };
<%       end -%>
	};
<%     end -%>
<%   end -%>
<%   if params['includes']
       params['includes'].each do |name| -%>
	include "<%= @_chrootref -%>/<%= name -%>";
<%     end
     end -%>
};
<% end -%>
