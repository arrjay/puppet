# LDAP server host
uri ldaps://<%= @server -%>:636/

# LDAP search base
base <%= @base %>

# LDAP search scope
scope sub

# LDAP filter options
pam_filter <%= @nss_filter %>

# TLS/SSL options
tls_cacertfile <%= @cafile %>

# These values should be a per-server account.
binddn <%= @binddn %>
bindpw <%= @bindpw %>

# We are AD here, configure accordingly
pam_password ad

<% if @nss_passwd_base != '' -%>
nss_base_passwd <%= @nss_passwd_base %>
<% end -%>
<% if @nss_group_base != '' -%>
nss_base_group <%= @nss_group_base %>
<% end -%>

# Only accept users in this range
pam_min_uid <%= @min_uid %>
pam_max_uid <%= @max_uid %>

# User ID attributes
pam_login_attribute <%= @userattr %>

# Group member attribute
pam_member_attribute <%= @groupattr %>

# Mapping NSS/LDAP attributes, objects
nss_map_objectclass posixAccount user
nss_map_objectclass shadowAccount user
nss_map_attribute uid sAMAccountName
nss_map_attribute homeDirectory unixHomeDirectory
nss_map_attribute shadowLastChange pwdLastSet
nss_map_objectclass posixGroup group
nss_map_attribute uniqueMember member
pam_login_attribute sAMAccountName
pam_filter objectclass=User
