# Base Server Tuneables
ServerTokens <%= @servertokens %>
ServerRoot <%= @serverroot %>
<% if @pidfile != '' -%>
PidFile <%= @pidfile %>
<% end -%>
Timeout <%= @timeout %>
<% if @keepalive == true -%>
KeepAlive On
<% else -%>
KeepAlive Off
<% end -%>
MaxKeepAliveRequests <%= @maxkeepaliverequests %>
KeepAliveTimeout <%= @keepalive_timeout %>

# MPM Tunables
<IfModule prefork.c>
<% @prefork_opts.sort.each do |key,value| -%>
<%= key -%> <%= value %>
<% end -%>
</IfModule>
<IfModule worker.c>
<% @worker_opts.sort.each do |key,value| -%>
<%= key -%> <%= value %>
<% end -%>
</IfModule>

<% # puppet doesn't provide great array primitives. attempt to derive what we need now. -%>
<% ports = [] -%>
<% @sites.sort.each do |site,keys| -%>
<%   if keys['port'] -%>
<%     ports << keys['port'] -%>
<%   end -%>
<% end -%>
Listen <%= ports.join(' ') %>
